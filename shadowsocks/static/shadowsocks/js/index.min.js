$(function(){loadStatus();$("#ss-start").on("click",function(a){if($(this).hasClass("weui-btn_plain-disabled")){return}ssStart()});$("#add").on("click",function(a){if(!$("#port").val()){$("#iosDialog2").show();$("#alert-msg").text("缺少端口号");return}else{if(!$("#pswd").val()){$("#iosDialog2").show();$("#alert-msg").text("缺少密码");return}else{if(!$("#add-auth").val()){$("#iosDialog2").show();$("#alert-msg").text("缺少授权码");return}}}$("#dialog-msg").text("确定添加？");$("#iosDialog1").show();$("#confirm").attr("data-type","add")});$("#ports-list").on("click",function(a){if($(a.target).hasClass("delete-d")){if(!$("#del-auth").val()){$("#iosDialog2").show();$("#alert-msg").text("缺少授权码");return}$("#dialog-msg").text("确定删除？");$("#iosDialog1").show().attr("data-port",$(a.target).parent().attr("data-port"));$("#confirm").attr("data-type","del")}});$("#confirm").on("click",function(b){$("#iosDialog1").hide();var a=$(this).attr("data-type");if(a==="del"){delPort($("#iosDialog1").attr("data-port"),$("#del-auth").val())}else{addPort($("#port").val(),$("#pswd").val(),$("#add-auth").val())}});$(".weui-navbar").on("click",function(a){var b=$(a.target).attr("data-id");$(a.target).addClass("weui-bar__item_on").siblings().removeClass("weui-bar__item_on");$("#"+b).show().siblings().hide();if(b==="page3"){loadList()}});$("#cancel").on("click",function(a){$("#iosDialog1").hide().attr("data-port","")});$("#alert-confirm").on("click",function(a){$("#iosDialog2").hide()})});function loadList(){$("#ports-list").empty();$("#loadingToast").show();$.ajax({type:"GET",url:"../ss/list",dataType:"json",success:function(g){if(g.errcode===0){var e=g.data;if(e){var d=e;for(port in d){var c=d[port];var f=$("<a>").addClass("weui-cell weui-cell_access");f.attr({href:"javascript:;",style:"text-decoration: none","data-port":port});var b=$("<div>").addClass("weui-cell__bd").append($("<p>").text(port));var a=$("<div>").addClass("weui-cell__ft delete-d").text(c);f.append(b).append(a);$("#ports-list").append(f)}}}},error:function(a){console.log(a)},complete:function(){$("#loadingToast").hide()}})}function loadStatus(){$("#loadingToast").show();$.ajax({type:"GET",url:"../ss/status",dataType:"json",success:function(a){if(a.errcode===0){if(a.status==="y"){$("#status-icon").addClass("weui-icon-success");$("#status-msg").text(a.msg);$("#ss-start").addClass("weui-btn_plain-disabled");$("#status-container").show()}else{$("#status-icon").addClass("weui-icon-warn");$("#status-msg").text(a.msg);$("#ss-start").addClass("weui-btn_plain-primary");$("#status-container").show()}}},error:function(a){console.log(a)},complete:function(){$("#loadingToast").hide()}})}function ssStart(){$("#loadingToast").show();$.ajax({type:"GET",url:"../ss/start",dataType:"json",success:function(a){if(a.errcode===0){if(a.status==="y"){$("#status-icon").removeClass("weui-icon-warn").addClass("weui-icon-success");$("#status-msg").text(a.msg);$("#ss-start").removeClass("weui-btn_plain-primary").addClass("weui-btn_plain-disabled")}else{$("#iosDialog2").show();$("#alert-msg").text(a.msg)}}},error:function(a){console.log(a)},complete:function(){$("#loadingToast").hide()}})}function addPort(b,a,c){$("#loadingToast").show();$.ajax({type:"GET",url:"../ss/add/"+b+"/"+a+"/"+c,dataType:"json",success:function(d){if(d.errcode===0){$("#iosDialog2").show();$("#alert-msg").text(d.msg);loadStatus();loadList()}},error:function(d){console.log(d)},complete:function(){$("#loadingToast").hide()}})}function delPort(a,b){$("#loadingToast").show();$.ajax({type:"GET",url:"../ss/del/"+a+"/"+b,dataType:"json",success:function(c){if(c.errcode===0){$("#iosDialog2").show();$("#alert-msg").text(c.msg);loadStatus();loadList()}},error:function(c){console.log(c)},complete:function(){$("#loadingToast").hide()}})};